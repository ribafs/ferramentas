<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Cantinho do Docker</title>
  <meta content="" name="descriptison">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="../assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="../assets/vendor/owl.carousel/../assets/owl.carousel.min.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="../assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Knight - v2.1.0
  * Template URL: https://bootstrapmade.com/knight-free-bootstrap-theme/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="d-flex align-items-center">
    <div class="container">

      <nav class="nav-menu d-none d-lg-block">
        <ul class="nav-inner">
          <li class="active"><a href="index.html">Início</a></li>
          <li class="drop-down"><a href="#">Introdução</a>
              <ul>
                  <li><a href="../introducao/index.html">Introdução</a></li>
                  <li><a href="../introducao/inst-linux.html">Instalação no Linux</a></li>
                  <li><a href="../introducao/inst-win.html">Instalação no Windows</a></li>
                  <li><a href="../introducao/linux.html">Comandos do Linux</a></li>
                  <li><a href="../introducao/redes.html">Redes no Docker</a></li>
                  <li><a href="../introducao/volumes.html">Volumes no Docker</a></li>
              </ul>
          </li>
          <li class="drop-down"><a href="">Projeto</a>
            <ul>
              <li><a href="index.html">Projeto</a></li>
              <li><a href="boas-praticas.html">Boas Práticas</a></li>
              <li><a href="estrutura.html">Estrutura</a></li>
            </ul>
          </li>

          <li class="drop-down"><a href="#">Conceitos</a>
            <ul>
              <li><a href="../conceitos/index.html">Conceitos</a></li>
              <li><a href="../conceitos/containers.html">Containers</a></li>
              <li><a href="../conceitos/docker.html">Docker</a></li>
              <li><a href="../conceitos/imagens.html">Imagens</a></li>
            </ul>
          </li>
          <li class="drop-down"><a href="#">Comandos</a>
            <ul>
              <li><a href="../comandos/index.html">Comandos</a></li>
              <li><a href="../comandos/comandos1.html">Comandos 1</a></li>
              <li><a href="../comandos/comandos2.html">Comandos 2</a></li>
            </ul>
          </li>

          <li class="drop-down"><a href="#">Imagens</a>
            <ul>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/CMS/Simples" target="_blank">CMS simples</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/Git" target="_blank">Git</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/GitHub" target="_blank">GitHub</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/Matematica" target="_blank">Matemática</a></li>
              <li><a href="ttps://github.com/ribafs/prog-web/tree/main/Ferramentas/VSCode" target="_blank">VSCode</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/faker2" target="_blank">Faker</a></li>
              <li><a href="https://github.com/ribafs/web-share" target="_blank" title="Compartilhar seu servidor web">Web Share</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas" target="_blank">Outras</a></li>
            </ul>
          </li>
          <li class="drop-down"><a href="#">Tutoriais</a>
            <ul>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/CMS/Simples" target="_blank">CMS simples</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/Git" target="_blank">Git</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/GitHub" target="_blank">GitHub</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/Matematica" target="_blank">Matemática</a></li>
              <li><a href="ttps://github.com/ribafs/prog-web/tree/main/Ferramentas/VSCode" target="_blank">VSCode</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/faker2" target="_blank">Faker</a></li>
              <li><a href="https://github.com/ribafs/web-share" target="_blank" title="Compartilhar seu servidor web">Web Share</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas" target="_blank">Outras</a></li>
            </ul>
          </li>

          <li class="drop-down"><a href="#">Containers</a>
            <ul>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/CMS/Simples" target="_blank">CMS simples</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/Git" target="_blank">Git</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/GitHub" target="_blank">GitHub</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/Matematica" target="_blank">Matemática</a></li>
              <li><a href="ttps://github.com/ribafs/prog-web/tree/main/Ferramentas/VSCode" target="_blank">VSCode</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas/faker2" target="_blank">Faker</a></li>
              <li><a href="https://github.com/ribafs/web-share" target="_blank" title="Compartilhar seu servidor web">Web Share</a></li>
              <li><a href="https://github.com/ribafs/prog-web/tree/main/Ferramentas" target="_blank">Outras</a></li>
              <li><a href="ferramentas.html" target="_blank">Ferramentas</a></li>
            </ul>
          </li>

          <li class="drop-down"><a href="#">Sobre</a>
            <ul>
              <li><a href="../livros">Meus livros</a></li>
              <li><a href="https://github.com/ribafs/" target="_blank">Meus Projetos</a></li>
              <li><a href="../curriculo.html">Currículo</a></li>
              <li><a href="../contato.html">Contato</a></li>
            </ul>
          </li>

        </ul>
      </nav><!-- .nav-menu -->
    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= About Us Section ======= -->
    <section>
      <div class="container">

          <h2 class="text-center">Boas Práticas</h2>
<div class="row">
<div class="col-md-2"></div>
<div class="col-md-8">

<div class="text-left">
<p>&Eacute; uma boa pr&aacute;tica comentar o Dockerfile</p>

<p><b>Algumas isntru&ccedil;&otilde;es do Dockerfile</b></p>

<p><b>FROM</b> - imagem</p>

<p>FROM alpine:3.11 AS alp-img</p>

<p>Ajuda a cria&ccedil;&atilde;o de um alias para o nome da imagem, como acima</p>

<p>
Evite adicionar pacotes desnecess&aacute;rios</p>

<p><b>LABEL</b> - documentar o projeto</p>

<p><b>Use um ou mais instruções LABEL</b><br />
LABEL com.example.version=&quot;0.0.1-beta&quot;<br />
LABEL vendor1=&quot;ACME Incorporated&quot;</p>

<p>LABEL vendor=ACME\ Incorporated \<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; com.example.is-beta= \<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; com.example.is-production=&quot;&quot; \<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; com.example.version=&quot;0.0.1-beta&quot; \<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; com.example.release-date=&quot;2015-02-12&quot;</p>

<p><b>RUN</b> - executar um ou mais comandos durante a cria&ccedil;&atilde;o do container</p>

<p>Manenha os argumentos em ordem alfab&eacute;tica</p>

<p>RUN apt-get update &amp;&amp; apt-get install -y \<br />
&nbsp; bzr \<br />
&nbsp; cvs \<br />
&nbsp; git \<br />
&nbsp; mercurial \<br />
&nbsp; subversion \<br />
&nbsp; &amp;&amp; rm -rf /var/lib/apt/lists/*</p>

<p>Quebre linhas grandes em pequenas com \</p>

<p>RUN apt-get update &amp;&amp; apt-get install -y \<br />
&nbsp;&nbsp;&nbsp; package-bar \<br />
&nbsp;&nbsp;&nbsp; package-baz \<br />
&nbsp;&nbsp;&nbsp; package-foo&nbsp; \<br />
&nbsp;&nbsp;&nbsp; &amp;&amp; rm -rf /var/lib/apt/lists/*</p>

<p>Sempre usa apt-get, ao inv&eacute;s de apenas apt</p>

<p>Sempre use apt-get update &amp;&amp; apt-get install -y ...</p>

<p>Usando pipes</p>

<p>RUN wget -O - https://some.site | wc -l &gt; /number</p>

<p><b>CMD</b> - executar um comando mas j&aacute; estando no ambiente do container.</p>

<p>Diferente do RUN que executa comandos durante a cria&ccedil;&atilde;o do container.</p>

<p>S&oacute; podemos executar um &uacute;nico CMD. Se usarmos v&aacute;rios, somente o &uacute;ltimo funcionar&aacute;.</p>

<p>Iniciar o apache numa distro tipo Debian</p>

<p>CMD [&quot;apache2&quot;,&quot;-DFOREGROUND&quot;]</p>

<p><b>EXPOSE</b> - indica em queal porta o container est&aacute; escutando por conex&otilde;es.</p>

<p>EXPOSE 80</p>

<p><b>ENV</b> - cria vari&aacute;veis de ambiente</p>

<p>ENV PATH=/usr/local/bin:$PATH</p>

<p>ENV PG_MAJOR=9.3<br />
ENV PG_VERSION=9.3.4<br />
RUN curl -SL https://example.com/postgres-$PG_VERSION.tar.xz | tar -xJC /usr/src/postgress &amp;&amp; &hellip;<br />
ENV PATH=/usr/local/postgres-$PG_MAJOR/bin:$PATH</p>

<p>ENV ADMIN_USER=&quot;mark&quot;<br />
RUN echo $ADMIN_USER &gt; ./mark<br />
RUN unset ADMIN_USER</p>

<p><b>ADD ou COPY</b></p>

<p>Similares mas o COPY &eacute; o preferido</p>

<p>COPY requirements.txt /tmp/<br />
RUN pip install --requirement /tmp/requirements.txt<br />
COPY . /tmp/</p>

<p><b>ENTRYPOINT</b> - O melhor uso para ENTRYPOINT &eacute; definir o comando principal da imagem, permitindo que a imagem seja executada como se fosse esse comando (e ent&atilde;o usar CMD como sinalizadores padr&atilde;o).<br />
Vamos come&ccedil;ar com um exemplo de imagem para a ferramenta de linha de comando s3cmd:</p>

<p>ENTRYPOINT [&quot;s3cmd&quot;]<br />
CMD [&quot;--help&quot;]</p>

<p>COPY ./docker-entrypoint.sh /<br />
ENTRYPOINT [&quot;/docker-entrypoint.sh&quot;]<br />
CMD [&quot;postgres&quot;]</p>

<p><b>VOLUME</b> - A instru&ccedil;&atilde;o VOLUME deve ser usada para expor qualquer &aacute;rea de armazenamento de banco de dados, armazenamento de configura&ccedil;&atilde;o ou arquivos/pastas criados por seu cont&ecirc;iner docker. &Eacute; altamente recomend&aacute;vel usar VOLUME para quaisquer partes mut&aacute;veis e/ou repar&aacute;veis pelo usu&aacute;rio de sua imagem.</p>

<p><b>USER</b> - Se um servi&ccedil;o puder ser executado sem privil&eacute;gios, use USER para mudar para um usu&aacute;rio n&atilde;o root. Comece criando o usu&aacute;rio e o grupo no Dockerfile com algo como RUN groupadd -r postgres &amp;&amp; useradd --no-log-init -r -g postgres postgres.</p>

<p><b>WORKDIR</b> - Para maior clareza e confiabilidade, voc&ecirc; deve sempre usar caminhos absolutos para o seu WORKDIR. Al&eacute;m disso, voc&ecirc; deve usar o WORKDIR em vez de proliferar instru&ccedil;&otilde;es como RUN cd ... &amp;&amp; do-something, que s&atilde;o dif&iacute;ceis de ler, solucionar problemas e manter.</p>

<p>https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</p>

<p><b>Boas pr&aacute;ticas com docker</b></p>

<p>Criando containers com docker-compose.yml</p>

<p><b>Supondo a estrutura abaixo</b></p>

<p>raiz<br />
&nbsp;&nbsp;&nbsp; db<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setup.sql<br />
&nbsp;&nbsp;&nbsp; web<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index.php<br />
&nbsp;&nbsp;&nbsp; docker-compose.yml<br />
&nbsp;&nbsp;&nbsp; Dockerfile-db<br />
&nbsp;&nbsp;&nbsp; Dockerfile-web</p>

<p>Idealmente n&atilde;o deixar os Dockerfile dentro das pastas db e web, pois ser&atilde;o enviados para a imagem do container, sem necessidade.<br />
Como os volumes db e web s&atilde;o serializados, todos os seus arquivos s&atilde;o enviados</p>

<br><h3>Algumas boaos práticas</h3><br>

<p>- N&atilde;o instale pacotes extras sem uma boa raz&atilde;o</p>

<p>- Evite configura&ccedil;&otilde;es n&atilde;o justificadas. Quanto mais limpos os arquivos Dockerfile e docker-composer.yml melhor.</p>

<p>- N&atilde;o mantenha arquivos tempor&aacute;rios na imagem. Arquivos baixados com wget e instalados devem ser removidos.</p>

<p>- Limpar/remover pacotes desnecess&aacute;rios e remover cache</p>

<p>- Organize os comandos por grupos</p>

<p>- Combine comandos</p>

<p>- Evite repeti&ccedil;&otilde;es nos arquivos de instala&ccedil;&atilde;o</p>

<p>- Evite usar ID de containers. Ao inv&eacute;s d&ecirc; um nome na cria&ccedil;&atilde;o e chame com seu nome, pois fica mais pr&aacute;tico e menos suscept&iacute;vel a erros</p>

<p>- Evite adicionar para a imagem algo que n&atilde;o &eacute; gen&eacute;rico, como ceros scripts sql, certas informa&ccedil;&otilde;es pessoais, etc.</p>

<p>- Adotar um padr&atilde;o para os nomes de imagens e dos containers, de forma a evitar erros e a facilitar o trabalho, especialmente em equipe.</p>

<p>Eu adoto assim:</p>

<p>apache-image<br />
php-image<br />
apache-container<br />
php-container</p>

<p>O importante &eacute; que se use um padr&atilde;o e isso vai ajudar na hora de nomear.</p>

<p>https://jonathan.bergknoff.com/journal/building-good-docker-images/</p>

<p>Crie cont&ecirc;ineres ef&ecirc;meros</p>

<p>A imagem definida por seu Dockerfile deve gerar cont&ecirc;ineres que sejam os mais ef&ecirc;meros poss&iacute;veis. Por &quot;ef&ecirc;mero&quot;, queremos dizer que o cont&ecirc;iner pode ser interrompido e destru&iacute;do e, em seguida, reconstru&iacute;do e substitu&iacute;do com um m&iacute;nimo absoluto de instala&ccedil;&atilde;o e configura&ccedil;&atilde;o.<br />
Consulte Processos sob a metodologia do aplicativo de doze fatores para ter uma ideia das motiva&ccedil;&otilde;es de executar cont&ecirc;ineres de maneira sem estado.</p>

<p>Compreenda o contexto de constru&ccedil;&atilde;o</p>

<p>Quando voc&ecirc; emite um comando docker build, o diret&oacute;rio de trabalho atual &eacute; chamado de contexto de constru&ccedil;&atilde;o. Por padr&atilde;o, presume-se que o Dockerfile esteja localizado aqui, mas voc&ecirc; pode especificar um local diferente com o sinalizador de arquivo (-f). Independentemente de onde o Dockerfile realmente resida, todos os conte&uacute;dos recursivos de arquivos e diret&oacute;rios no diret&oacute;rio atual s&atilde;o enviados para o daemon do Docker como o contexto de constru&ccedil;&atilde;o.</p>

<p>N&atilde;o inclua arquivos desnecess&aacute;rios</p>

<p>Nem configura&ccedil;&otilde;es desnecess&aacute;rias</p>

<p>Excluir com .dockerignore<br />
Para excluir arquivos n&atilde;o relevantes para a compila&ccedil;&atilde;o (sem reestruturar seu reposit&oacute;rio de origem), use um arquivo .dockerignore. Este arquivo oferece suporte a padr&otilde;es de exclus&atilde;o semelhantes aos arquivos .gitignore. Para obter informa&ccedil;&otilde;es sobre como criar um, consulte o arquivo .dockerignore.</p>

<p>Desacople as aplica&ccedil;&otilde;es, as camadas</p>

<p>Reduza o n&uacute;mero de camadas</p>

<p>Abandone cache. Use quando puder --no-cache=true</p>
                    </div>
                </div>
            </div>
          </div>
        </div>

      </div>
    </section><!-- End About Us Section -->

  <!-- ======= Footer ======= -->
  <footer id="footer">

    <div class="container footer-bottom clearfix">
      <div class="copyright">
        &copy; Copyright <strong><span>Knight</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/knight-free-bootstrap-theme/ -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/jquery/jquery.min.js"></script>
  <script src="../assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="../assets/vendor/jquery-sticky/jquery.sticky.js"></script>
  <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../assets/vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>

  <!-- Template Main JS File -->
  <script src="../assets/js/main.js"></script>

</body>

</html>
